Bootstrap: docker

From: nvcr.io/nvidia/cuda:12.0.1-devel-rockylinux8


%files
   only_till_casacpp.sh /
   readline.pc /
   
%labels

   Author pjaganna@nrao.edu
   Version v0.0.1 

%post

   dnf -y install epel-release
   dnf install -y dnf-plugins-core
   dnf config-manager --set-enabled powertools
 
   # Packages needed for casacore development
   dnf -y install git cmake gcc-c++ gcc-gfortran gtest-devel ccache readline-devel ncurses-devel blas-devel lapack-devel cfitsio-devel fftw-devel wcslib-devel python38 python38-devel python38-numpy flex bison tar curl

   # Packages needed for libsakura development
   dnf -y install eigen3-devel fftw-devel openmpi-devel gsl-devel
 
   dnf -y install https://casa.nrao.edu/download/devel/grpc/el8-1.18/protobuf-3.6.1-3.el8.x86_64.rpm
   dnf -y install https://casa.nrao.edu/download/devel/grpc/el8-1.18/protobuf-compiler-3.6.1-3.el8.x86_64.rpm
   dnf -y install https://casa.nrao.edu/download/devel/grpc/el8-1.18/protobuf-devel-3.6.1-3.el8.x86_64.rpm
   dnf -y install https://casa.nrao.edu/download/devel/grpc/el8-1.18/grpc-1.18.0-2.el8.x86_64.rpm
   dnf -y install https://casa.nrao.edu/download/devel/grpc/el8-1.18/grpc-devel-1.18.0-2.el8.x86_64.rpm
   dnf -y install https://casa.nrao.edu/download/devel/grpc/el8-1.18/grpc-plugins-1.18.0-2.el8.x86_64.rpm

   # Post installation making path /casa_builds/
   mv /readline.pc /usr/lib64/pkgconfig/
   mkdir -p /casa_builds
   mkdir -p /casa_builds/roadrunner/
   sh /only_till_casacpp.sh

%environment


%runscript 
	   /casa_builds/roadrunner/build/casacpp/synthesis/tRoadRunner $*

%apprun roadrunner
      /casa_builds/roadrunner/build/casacpp/synthesis/tRoadRunner $*

%apphelp roadrunner
      The roadrunner application is a CASA (https://open-bitbucket.nrao.edu/projects/CASA/repos/casa6/browse)
      code based gridder that can be deployed on a GPU/CPU for gridding. The application takes inputs either
      from the commandline or through an interactive shell environment. In order to run this on a GPU please
      don not forget to bind it with commandline using the --nv flag.

%help
      The container is holds the roadrunner app which can be run via the singularity app command once the
      container has been built.
